<!doctype html>
<html manifest="../manifests/itinerary-3-1403156418.manifest" class="no-js" lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Itinerary - Watering Holes</title>
        <link rel="stylesheet" href="../css/idangerous.swiper.css" />
        <link rel="stylesheet" href="../css/style.css" />
        <link rel="stylesheet" href="../css/swiper.css" />
        <script src="../js/vendor/modernizr.js"></script>
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcRjvvKaoJuT_-v4op_kWwsV5rwQEIRG8&sensor=true"></script>
    </head>
<body>
<div id="mapPreload" class="overlay loading white"></div>
<div class="get-position"><a href="#"></a></div>
    <div id="swiperHolder" class="swiper-holder">
        <div id="swiperContainer" class="swiper-container">
            <div id="swiperWrapper" class="swiper-wrapper">
            <div class="swiper-slide white-slide"><a class="toggle-up-down slide-up"></a><div class="title"><h2>Fortune of War</h2><span>Circular Quay</span></div><div class="img-thmb"><img src="../img/itineraries/locations/landscape/med/fortune-of-war.jpg" alt="" /></div><div class="contentHolder"><p>The Fortune of War dates from 1828 and is Sydney's oldest pub. Embodied in the history of Sydney, the bar was the first and last port of call for generations of sailors and the troops of the Australian Armed Forces who were to experience the 'fortune of the war' when they departed Sydney Cove to defend their country. Whilst retaining its old world charm, the hotel has built an enviable reputation, for providing a warm and traditional service in a cosy, heritage bar.</p></div></div><div class="swiper-slide white-slide"><a class="toggle-up-down slide-up"></a><div class="title"><h2>The Glenmore</h2><span>The Rocks</span></div><div class="img-thmb"><img src="../img/itineraries/locations/landscape/med/the-glenmore.jpg" alt="" /></div><div class="contentHolder"><p>The Glenmore Hotel was built by Brewers Tooth & Co in 1921 and has been an Aussie icon ever
since. With its colonial old English charm and character, The Glenmore is a popular watering hole
and has survived depressions, wars and plagues. The Glenmore is now one of Sydney's premier
rooftop venues with 180 degree sweeping views of Sydney harbour and the CBD.</p></div></div><div class="swiper-slide white-slide"><a class="toggle-up-down slide-up"></a><div class="title"><h2>East Village Hotel</h2><span>Balmain</span></div><div class="img-thmb"><img src="../img/itineraries/locations/landscape/med/east-village-hotel.jpg" alt="" /></div><div class="contentHolder"><p>The East Village Hotel is a pub with a penchant for craft beer and it's a look that works. The crowd here is made up of families, young professionals and well-dressed Balmain locals who split their time between the shady beer garden, dining room and the front bar. The heavy timber tables and fireplace have an old-fashioned and comforting feel, and anyone will feel welcome at The East Village.</p></div></div><div class="swiper-slide white-slide"><a class="toggle-up-down slide-up"></a><div class="title"><h2>The Royal Oak</h2><span>Balmain</span></div><div class="img-thmb"><img src="../img/itineraries/locations/landscape/med/the-royal-oaks.jpg" alt="" /></div><div class="contentHolder"><p>The Royal Oak is regarded as one of the finest pubs in Balmain. Famous for its food, the Oak prides itself on using fresh, seasonal and ethically sourced ingredients to produce delicious meals of generous portions. Balancing old world charm with modern day design, the Royal Oak is a popular destination for both locals and visitors alike and offers a great range of local and imported beers both on tap and in the bottle.</p></div></div>
            </div>
        </div>
    </div>
    <div class="paginationHolder">
        <div class="pagination"></div>
    </div>
    <div class="map-large" id="mapCanvas">
    </div>
<script src="../js/vendor/jquery.js"></script>
<script src="../js/vendor/swiper/idangerous.swiper-2.1.min.js"></script>
<script>


 $(function(){
    $(window).resize(function() {
        mySwiper.reInit();
    });
    $(window).load(function() {
        mySwiper.reInit();
    });

    $('.get-position a').click(function(e) {
        e.preventDefault();
        if ($(this).hasClass('active') && markerInBounds(userLocationMarker))
        {
            $(this).removeClass('active');
            map.panTo(activeLatLng);
            if (!$.isEmptyObject(userLocationMarker))
            {
                //remove user location marker and accuracy circle - empty out objects
                userLocationMarker.setMap(null);
            }
        }
        else
        {
             $(this).addClass('active');
             getUserLocation($(this));
        }
    });

    var activeIndex = 0;
    var activeLat = latLngArray[activeIndex].lat;
    var activeLng = latLngArray[activeIndex].lng;
    var activeLatLng = new google.maps.LatLng(activeLat,activeLng);
    var activeSlide = $('.swiper-slide').eq(activeIndex);

    var mySwiper = new Swiper('.swiper-container',{
        pagination: '.pagination',
        paginationClickable: true,
        centeredSlides: true,
        slidesPerView: 'auto',
        resizeReInit: true,
        onSlideChangeEnd: function(swiper) {
            activeIndex = swiper.activeIndex;
            console.log('active Index['+activeIndex+']');
            activeSlide = $('.swiper-slide').eq(activeIndex);
            activeLat = latLngArray[activeIndex].lat;
            activeLng = latLngArray[activeIndex].lng;
            activeLatLng = new google.maps.LatLng(activeLat,activeLng);
            markerArray[swiper.previousIndex].setAnimation(null);
            markerArray[swiper.previousIndex].setIcon('../img/marker-orange-hollow.png')
            markerArray[activeIndex].setIcon('../img/marker-orange.png');
            markerArray[activeIndex].setAnimation(google.maps.Animation.BOUNCE);
            setTimeout(function() {
                markerArray[activeIndex].setAnimation(null);
            }, 750);
            map.panTo(activeLatLng);
        }
    });

    $(function() {
        $('body').on('click', '.toggle-up-down', function() {
            if ($(this).hasClass('slide-up'))
            {
                $('.toggle-up-down').removeClass('slide-up').addClass('slide-down');
                $('#swiperHolder').removeClass('holder-shrink').addClass('holder-grow');
            }else if ($(this).hasClass('slide-down')) {
                $('.toggle-up-down').removeClass('slide-down').addClass('slide-up');
                $('#swiperHolder').removeClass('holder-grow').addClass('holder-shrink');
            }
        });
    });
 });
</script>
<script>



    var browserGeoLocationSupport = false;
    var userLocationMarker = {};
    var userLocationAccuracyCircle = {};

    if(navigator.geolocation) {
        browserGeoLocationSupport = true;
    }

    var map;
    var marker;
    var markerArray = [];
    var directionsDisplay;
    var directionsService = new google.maps.DirectionsService();

    var polylineOptionsActual = new google.maps.Polyline({
        strokeColor: '#6eb240',
        strokeOpacity: 1.0,
        strokeWeight: 3
    });

    var latLngArray = [{lat: -33.86033790,lng: 151.20842680},{lat: -33.85877800,lng: 151.20729400},{lat: -33.85774500,lng: 151.19252900},{lat: -33.85589400,lng: 151.18095200}];

    initialize();

    function initialize() {
        directionsDisplay = new google.maps.DirectionsRenderer({
            polylineOptions: {
                strokeColor: '#6eb240',
                strokeOpacity: 1.0,
                strokeWeight: 3
            },
            suppressMarkers: true,
            preserveViewport: true
        });
        mapOptions = {
            center: new google.maps.LatLng(latLngArray[0].lat,latLngArray[0].lng),
            zoom: 15,
            zoomControl: false,
            mapTypeControlOptions: {
                style: google.maps.MapTypeControlStyle.DROPDOWN_MENU,
                position: google.maps.ControlPosition.TOP_CENTER
            }
        };

        map = new google.maps.Map(document.getElementById("mapCanvas"),mapOptions);
        directionsDisplay.setMap(map);

        var styles = [
            {
                "featureType": "transit.line",
                "elementType": "geometry.fill",
                "stylers": [
                    {"visibility": "off" }
                ]
            },
            {
                "featureType":"water",
                "stylers": [
                    {"visibility":"on"},
                    {"color":"#acbcc9"}
                ]
            },
            {
                "featureType":"landscape",
                "stylers":[
                    {"color":"#f2e5d4"}
                ]
            },
            {
                "featureType":"road.highway",
                "elementType":"geometry",
                "stylers": [
                    {"color":"#c5c6c6"}
                ]
            },
            {
                "featureType":"road.arterial",
                "elementType":"geometry",
                "stylers": [
                    {"color":"#e4d7c6"}
                ]
            },
            {
                "featureType":"road.local",
                "elementType":"geometry",
                "stylers": [
                    {
                        "color":"#fbfaf7"
                    }
                ]
            },
            {
                "featureType":"poi.park",
                "elementType":"geometry",
                "stylers": [
                    {
                        "visibility":"off"
                    },
                    {
                        "color":"#c5dac6"
                    }
                ]
            },
            {
                "featureType":"administrative",
                "stylers": [
                    {
                        "visibility":"off"
                    },
                    {
                        "lightness":33
                    }
                ]
            },
            {
                "featureType":"road"
            },
            {
                "featureType":"poi.park",
                "elementType":"labels",
                "stylers": [
                    {
                        "visibility":"off"
                    },
                    {
                        "lightness":20
                    }
                ]
            },
            {
                "featureType":"poi.business",
                "elementType":"labels",
                "stylers": [
                    {
                        "lightness":20
                    }
                ]
            },
            {

            },
            {
                "featureType":"road",
                "stylers": [
                    {
                        "lightness":20
                    }
                ]
            }
        ]


        var styledMap = new google.maps.StyledMapType(styles, {name: "Map"});

        map.mapTypes.set('map_style', styledMap);
        map.setMapTypeId('map_style');

        var i = 0;

        calcRoute();

        for (i=0; i<latLngArray.length; i++)
        {
            (function(latLngArray){
                var latLng = new google.maps.LatLng(latLngArray.lat,latLngArray.lng);
                var icon;
                if (i === 0)
                {
                    icon = '../img/marker-orange.png';
                }
                else
                {
                    icon = '../img/marker-orange-hollow.png';
                }

                marker = new google.maps.Marker({
                    position: latLng,
                    icon: icon,
                    map: map
                });
                markerArray.push(marker);
            }(latLngArray[i]));
        }

        google.maps.event.addListener(map, 'tilesloaded', function(evt) {
            //$('#mapPreload').remove();
            $('#mapPreload').hide();
        });

        function calcRoute() {
            var start, end;
            var waypoints = [];
            var endpoint = (latLngArray.length - 2);//remember our array is zero-based
            start = new google.maps.LatLng(latLngArray[0].lat,latLngArray[0].lng);
            end = new google.maps.LatLng(latLngArray[latLngArray.length - 1].lat,latLngArray[latLngArray.length - 1].lng);
            for (var i = 1; i < endpoint; i++)
            {
                waypoints.push({
                    location: new google.maps.LatLng(latLngArray[i].lat,latLngArray[i].lng),
                    stopover: true
                });
            }

            var request = {
                origin: start,
                destination: end,
                waypoints: waypoints,
                optimizeWaypoints: true,
                travelMode: google.maps.TravelMode.WALKING
            };

            directionsService.route(request, function(response, status) {
                //console.dir(response);
                if (status == google.maps.DirectionsStatus.OK) {
                    directionsDisplay.setDirections(response);
                }
            });
        }
    }

    function getUserLocation(el) {
        el.addClass('loading');
        // Try W3C Geolocation (Preferred)
        if (!$.isEmptyObject(userLocationMarker))
        {
            //remove user location marker and accuracy circle - empty out objects
            userLocationMarker.setMap(null);
            userLocationAccuracyCircle.setMap(null);
            userLocationMarker = {};
            userLocationAccuracyCircle = {};
        }
        if(browserGeoLocationSupport) {
            navigator.geolocation.getCurrentPosition(function(position) {
                initialLocation = new google.maps.LatLng(position.coords.latitude,position.coords.longitude);
                accuracy = position.coords.accuracy;
                userLocationMarker = new google.maps.Marker({
                    position: initialLocation,
                    map: map,
                    icon: '../img/location-dot.png'
                });
                userLocationAccuracyCircle = new google.maps.Circle({
                    center: initialLocation,
                    radius: accuracy,
                    map: map,
                    fillColor: '#0000ff',
                    fillOpacity: 0.1,
                    strokeColor: '#0000ff',
                    strokeOpacity: 0.25,
                    strokeWeight: 1
                });
                map.setCenter(initialLocation);
                map.fitBounds(userLocationAccuracyCircle.getBounds());
                el.removeClass('loading');
            }, function() {
                handleNoGeolocation(browserGeoLocationSupport);
                el.removeClass('loading');
            });
        }
        // Browser doesn't support Geolocation
        else {
            handleNoGeolocation(browserGeoLocationSupport);
            el.removeClass('loading');
        }
    }

    function handleNoGeolocation(errorFlag) {
        if (errorFlag == true) {
            alert("Geolocation service failed.");
            initialLocation = sydney;
        } else {
            alert("Your browser doesn't support geolocation. We've placed you in Sydney.");
            initialLocation = sydney;
        }
        map.setCenter(initialLocation);
    }

    function markerInBounds(marker){
        return map.getBounds().contains(marker.getPosition());
    }


</script>
</body>
</html>